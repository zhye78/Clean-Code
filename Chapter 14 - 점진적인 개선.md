# Chapter 14 - 점진적인 개선

이 장은 점진적인 개선을 보여주는 사례를 설명한다. 출발을 좋았으나 확장성이 부족했던 모듈을 소개하고 개선하는 단계로 살펴본다.


## Args 구현

목록 14-2 ~ 14-7 참고)</br>

이름을 붙인 방법, 함수 크기, 코드 형식에 주목을 해 본다면 전반적으로 깔끔한 구조에 잘 짜인 프로그램이라고 볼 수 있다.</br>
날짜 인수나 복소수 인수 등 새로운 인수 유형을 추가하는 방법이 명백하며, 고칠 코드도 별로 없다.

### 어떻게 짰느냐고?

프로그래밍은 과학보다 공예(craft)에 가깝다. 깨끗한 코드를 짜려면 먼저 지저분한 코드를 짠 뒤에 정리해야 한다는 뜻이다.</br>

대부분의 신입 개발자는 무조건 돌아가는 프로그램을 목표로 잡는다. 일단 프로그램이 '돌아가면' 다음 업무로 넘어가고, '돌아가는' 프로그램은 그 상태가 어떻든 그대로 버려둔다. 경험이 풍부한 전문 프로그래머라면 이런 행동이 전문가로서 자살 행위라는 사실을 잘 안다.


## 1차 초안

목록 14-8 참고)</br>
아주 지저분한 코드라는 것을 알 수 있다. 첫 버전이던 Boolean 인수만 지원하던 초기 버전에서 String과 Integer 인수 유형을 추가하면서 부터 재앙이 시작되었다.

### 그래서 멈췄다

추가할 인수 유형이 적어도 두 개는 더 있었는데 그러면 코드가 훨씬 더 나빠질 것이 분명해서 멈추고 코드 구조를 유지보수했다.</br>
인수 유형은 다양하지만 모두가 유사한 메서드를 제공하므로 클래스 하나가 적합하다 판단했다. 그래서 ArgumentMarshaler라는 개념이 탄생했다.

### 점진적으로 개선하다

프로그램을 망치는 가장 좋은 방법 중 하나는 개선으로 구조를 크게 뒤집는 행위이다. 어떤 프로그램은 그저 그런 '개선'에서 결코 회복하지 못한다. '개선' 전과 똑같이 프로그램을 돌리기가 아주 어렵기 때문이다.

그래서 ***테스트 주도 개발(TDD)*** 기법을 사용했다. TDD는 언제 어느 때라도 시스템이 돌아가야 한다는 원칙을 따른다. 다시 말해, TDD는 시스템을 망가뜨리는 변경을 허용하지 않으며, 변경을 가한 후에도 시스템이 변경 전과 똑같이 돌아가야 한다.

목록 14-11 참고)


## String 인수

String 인수를 추가하는 과정은 boolean 인수와 매우 유사했다. 각 인수 유형을 처리하는 코드를 모두 ArgumentMarshaler 클래스에 넣고 나서 그 파생 클래스를 만들어 코드를 분리할 계획을 세우고 진행했다.</br>

또한 모든 예외를 하나로 모아 ArgsException 클래스를 만든 후 독자 모듈로 옮긴다. 이렇게 되면 Args 모듈에서 예외/오류 처리 코드를 완벽하게 분리할 수 있다.


## 최종 코드

목록 14-15 ~ 14-16 참고)</br>

Args 클래스에서 코드 중복을 최소화하고, 상당한 코드를 Args 클래스에서 ArgsException 클래스로 옮겼다. 또한 ArgumentMarshaler 클래스를 통해 여러 인수에 대한 추후 확장성을 생각했다.</br>

소프트웨어 설계는 분할만 잘해도 품질이 크게 높아진다. 적절한 장소를 만들어 코드만 분리해도 설계가 좋아진다. 관심사를 분리하면 코드를 이해하고 보수하기 훨씬 더 쉬워진다.</br>


## 결론

그저 돌아가는 코드만으로는 부족하다.</br>
나쁜 코드보다 더 오랫동안 더 심각하게 개발 프로젝트에 악영향을 미치는 요인도 없다. 나쁜 일정은 다시 짜면 된다. 나쁜 요구사항은 다시 정의하면 된다. 나쁜 팀 역학은 복구하면 된다. 하지만 나쁜 코드는 썩어 문드러진다.</br>
코드는 언제나 최대한 깔끔하고 단순하게 정리하자. 절대로 썩어가게 방치하면 안 된다.